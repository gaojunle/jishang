<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>融创西南名片</title>
    <meta name="keywords" content="融创西南名片" />
    <meta name="description" content="融创西南名片" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" href="./img/common/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="./img/common/favicon.ico" />
    <link rel="stylesheet" href="./css/lib/common.css">
    <link rel="stylesheet" href="./css/lib/mobileSelect.css">
    <link rel="stylesheet" href="./css/lib/swiper.min.css">
    <link rel="stylesheet" href="./css/page/poster.css" />
    <script src="./js/lib/viewbox.js"></script>
</head>

<body>
    <div class="header headerTop">
        <img src="./img/logo.png" alt="" class="logo">
        <!-- <span class="msg">早上好，融创家人们！</span> -->
        <div class="selcity js-select">
            <div class="sel-val"
                style="font-size: 15px;color: #8f8f8f;display: inline-block;width: 100px;text-align: right;"></div>
            <select class="sel-data" data-title="请选择城市" style="display: none;">
                <option value="1" selected>上海</option>
                <option value="2">无锡</option>
                <option value="3">西安</option>
            </select>
            <img class="icon-down" src="./img/common/icon-down.png" alt="">
        </div>
    </div>

    <div class="poster-swiper js-scale-swiper">
        <ul class="swiper-wrapper">
            <li class="swiper-slide" data-swiper-autoplay="2000">
                <a href="javascript:;">
                    <img class="pavt" src="./img/poster/poster_1.png" />
                    <div class="info">
                        <img class="timg" src="./img/poster/timg.png" alt="">
                        <span class="nick">阳光美好的小情节</span>
                        <img class="srcode" src="./img/poster/srcode.png" alt="">
                    </div>
                </a>
            </li>
            <li class="swiper-slide" data-swiper-autoplay="2000">
                <a href="javascript:;">
                    <img class="pavt" src="./img/poster/poster_1.png" />
                    <div class="info">
                        <img class="timg" src="./img/poster/timg.png" alt="">
                        <span class="nick">阳光美好的小情节</span>
                        <img class="srcode" src="./img/poster/srcode.png" alt="">
                    </div>
                </a>
            </li>
            <li class="swiper-slide" data-swiper-autoplay="2000">
                <a href="javascript:;">
                    <img class="pavt" src="./img/poster/poster_1.png" />
                    <div class="info">
                        <img class="timg" src="./img/poster/timg.png" alt="">
                        <span class="nick">阳光美好的小情节</span>
                        <img class="srcode" src="./img/poster/srcode.png" alt="">
                    </div>
                </a>
            </li>
        </ul>
    </div>

    <div class="products">
        <div class="tip">▲ 长按上方图片保存 ▲</div>
        <div class="cards-wrapper js-carousel-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide"> <img src="./img/poster/p1.png" /><span>御栖湖</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p2.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p3.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p1.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p2.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p3.png" /><span>溪山春晓</span></li>
            </ul>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>
    <div class="share_box">分享给好友</div>
    <script src="./js/lib/jquery.min.js"></script>
    <script src="./js/lib/artDialog.js"></script>
    <script src="./js/lib/mobileSelect.js"></script>
    <script src="./js/lib/swiper.min.js"></script>
    <script src="js/lib/html2canvas.min.js"></script>
    <script src="js/lib/canvas2image.js"></script>
    <script>
        jQuery(function ($) {
            var App = {
                init: function () {
                    this.initData();
                    this.bindEvent();
                },
                bindEvent: function () {
                    this.initSelect();
                    $('.share_box').click(function () {
                        App.convert2canvas($('.swiper-slide-active a')).then(function ($img) {
                            $('body').append($img);
                        })
                    })
                },
                initData: function () {
                    this.initSwiper();
                },

                initSwiper: function () {
                    var swiperBanner = new Swiper('.js-banner-swiper', {
                        spaceBetween: 0,
                        centeredSlides: true,
                        autoplay: 4000,
                        loop: true,
                        pagination: '.swiper-pagination'
                    });
                    new Swiper('.js-scale-swiper', {
                        slidesPerView: 'auto',
                        spaceBetween: '3%',
                        centeredSlides: true,
                        autoplay: false,
                        loop: true,
                        pagination: '.swiper-pagination'
                    });
                    new Swiper('.js-carousel-swiper', {
                        slidesPerView: 'auto',
                        spaceBetween: 14,
                        //autoplay: 4000,
                        slidesPerView: 5,
                        loop: true,
                        pagination: '.swiper-pagination',
                        prevButton: '.swiper-button-prev',
                        nextButton: '.swiper-button-next',
                    });
                    $('.js-carousel-swiper').on('click', '.swiper-slide', function () {
                        $(this).addClass('selected').siblings().removeClass('selected')
                    })
                },
                convert2canvas: function ($coverDom) {
                    var width = $coverDom.width(); //获取dom 宽度
                    var height = $coverDom.height(); //获取dom 高度
                    var canvas = document.createElement("canvas"); //创建一个canvas节点
                    var scale = 2; //定义任意放大倍数 支持小数
                    canvas.width = width * scale; //定义canvas 宽度 * 缩放
                    canvas.height = height * scale; //定义canvas高度 *缩放
                    //canvas.getContext("2d")
                    //修改偏移量
                    canvasDom = canvas.getContext("2d");
                    canvasDom.scale(scale, scale); //获取context,设置scale
                    canvasDom.translate('-' + ($coverDom[0].offsetLeft), '-' + ($coverDom[0].offsetTop));
                    console.log($coverDom[0].offsetLeft)
                    console.log($coverDom)
                    var opts = {
                        scale: scale, // 添加的scale 参数
                        canvas: canvas, //自定义 canvas
                        // logging: true, //日志开关，便于查看html2canvas的内部执行流程
                        width: width, //dom 原始宽度
                        height: height,
                        useCORS: true // 【重要】开启跨域配置
                    };

                    return html2canvas($coverDom[0], opts).then(function (canvas) {
                        var context = canvas.getContext('2d');
                        // 【重要】关闭抗锯齿
                        context.mozImageSmoothingEnabled = false;
                        context.webkitImageSmoothingEnabled = false;
                        context.msImageSmoothingEnabled = false;
                        context.imageSmoothingEnabled = false;

                        // 【重要】默认转化的格式为png,也可设置为其他格式
                        var $img = $(Canvas2Image.convertToPNG(canvas, canvas.width, canvas.height))
                            .css({
                                "width": canvas.width / 2 + "px",
                                "height": canvas.height / 2 + "px",
                            })
                        return $img;
                    });
                },

                initSelect: function () {
                    $('.js-select').each(function () {
                        var $this = $(this),
                            $selData = $this.find('select');

                        if ($selData.length == 0) {
                            return false;
                        }

                        var data = [];
                        $selData.find('option').each(function () {
                            data.push({ id: $(this).val(), value: $(this).html() })
                            if ($(this).prop('selected')) {
                                $this.find('.sel-val').html($(this).html());
                            }
                        });

                        new MobileSelect({
                            trigger: this,
                            title: $selData.data('title'),
                            wheels: [
                                { data: data }
                            ],
                            callback: function (indexArr, data) {
                                console.log(data)
                                /*TODO 这里处理选择后事件*/
                                $this.find('.sel-val').html(data[0].value);
                            }
                        });
                    })
                }
            };
            App.init();
        })
    </script>
</body>

</html>