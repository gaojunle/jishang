<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>融创西南名片</title>
    <meta name="keywords" content="融创西南名片" />
    <meta name="description" content="融创西南名片" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" href="./img/common/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="./img/common/favicon.ico" />
    <link rel="stylesheet" href="./css/lib/common.css">
    <link rel="stylesheet" href="./css/lib/mobileSelect.css">
    <link rel="stylesheet" href="./css/lib/swiper.min.css">
    <link rel="stylesheet" href="./css/page/poster.css" />
    <script src="./js/lib/viewbox.js"></script>
</head>

<body>
    <div class="header headerTop">
        <img src="./img/logo.png" alt="" class="logo">
        <!-- <span class="msg">早上好，融创家人们！</span> -->
        <div class="selcity js-select">
            <div class="sel-val"
                style="font-size: 15px;color: #8f8f8f;display: inline-block;width: 100px;text-align: right;"></div>
            <select class="sel-data" data-title="请选择城市" style="display: none;">
                <option value="1" selected>上海</option>
                <option value="2">无锡</option>
                <option value="3">西安</option>
            </select>
            <img class="icon-down" src="./img/common/icon-down.png" alt="">
        </div>
    </div>

    <div class="products_posters">
        <div class="poster-swiper on js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="poster-swiper js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="poster-swiper js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="poster-swiper js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="poster-swiper js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="poster-swiper js-scale-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
                <li class="swiper-slide" data-swiper-autoplay="2000">
                    <a href="javascript:;">
                        <img class="pavt" src="./img/poster/poster_1.png" />
                        <div class="info">
                            <img class="timg" src="./img/poster/timg.png" alt="">
                            <span class="nick">阳光美好的小情节</span>
                            <img class="srcode" src="./img/poster/srcode.png" alt="">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="products">
        <div class="tip">▲ 点击分享 ▲</div>
        <div class="cards-wrapper js-carousel-swiper">
            <ul class="swiper-wrapper">
                <li class="swiper-slide selected"> <img src="./img/poster/p1.png" /><span>御栖湖</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p2.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p3.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p1.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p2.png" /><span>溪山春晓</span></li>
                <li class="swiper-slide"> <img src="./img/poster/p3.png" /><span>溪山春晓</span></li>
            </ul>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </div>
    <a href="./勋章.html" class="share_box">分享给好友</a>
    <div class="pop_box create_poster_box js_pst">
        <div class="pop_cont">
            <div class="tmpPostBox"></div>
            <div class="inner">
                <img class="pop_close" src="./img/common/icon_close.png" alt="">

                <div class="pop_img_wraper">
                    <div class="js_poster_img"></div>
                    <div class="tip">▲ 长按上方图片保存 ▲</div>
                </div>
            </div>
        </div>
    </div>
    <script src="./js/lib/jquery.min.js"></script>
    <script src="./js/lib/artDialog.js"></script>
    <script src="./js/lib/mobileSelect.js"></script>
    <script src="./js/lib/swiper.min.js"></script>
    <script src="js/lib/html2canvas.min.js"></script>
    <script src="js/lib/canvas2image.js"></script>
    <script>
        jQuery(function ($) {
            var App = {
                scaleSwiper: null,
                init: function () {
                    this.initData();
                    this.bindEvent();
                    this.initScaleSwiper()
                },
                bindEvent: function () {
                    this.initSelect();
                    this.bindPopClose();
                },
                initData: function () {
                    this.initSwiper();
                },
                bindPopClose: function () {
                    $('.pop_close').click(function () {
                        $('.pop_box').removeClass('show')
                        return false;
                    })
                },
                initSwiper: function () {
                    var swiperBanner = new Swiper('.js-banner-swiper', {
                        spaceBetween: 0,
                        centeredSlides: true,
                        autoplay: 4000,
                        loop: true,
                        effect: 'cube',
                        pagination: '.swiper-pagination'
                    });
                    new Swiper('.js-carousel-swiper', {
                        slidesPerView: 'auto',
                        spaceBetween: 14,
                        //autoplay: 4000,
                        slidesPerView: 5,
                        //loop: true,
                        pagination: '.swiper-pagination',
                        prevButton: '.swiper-button-prev',
                        nextButton: '.swiper-button-next',
                        onClick: function (swiper) {
                            console.log(swiper)
                            $(swiper.clickedSlide).addClass('selected').siblings().removeClass('selected');
                            $('.js-scale-swiper').eq(swiper.clickedIndex).addClass('on').siblings().removeClass('on');
                            App.initScaleSwiper();
                        }
                    });
                },
                initScaleSwiper() {
                    this.scaleSwiper && this.scaleSwiper.destroy()
                    this.scaleSwiper = new Swiper('.js-scale-swiper.on', {
                        slidesPerView: 'auto',
                        spaceBetween: '3%',
                        centeredSlides: true,
                        autoplay: false,
                        //loop: true,
                        initialSlide: 1,
                        pagination: '.swiper-pagination',
                        onSlideChangeEnd: function (swiper) {

                        },
                        onInit: function (swiper) {
                        },
                        onClick: function (swiper) {
                            var $tmpPostBox = $('.tmpPostBox'),
                                $curSwiperSlide = $(swiper.slides[swiper.activeIndex])
                            $tmpPostBox.empty().append($curSwiperSlide.clone())
                            console.log($tmpPostBox)

                            $('.js_pst').addClass('show')
                            setTimeout(function () {
                                App.convercanvas($('.tmpPostBox')).then(function ($img) {
                                    //$curSwiperSlide.append($img);
                                    $('.js_poster_img').empty().append($img);
                                    $('.inner').show();
                                })
                            }, 100)
                        }
                    });

                },
                convercanvas: function ($coverDom) {
                    var width = $coverDom.width(); //获取dom 宽度
                    var height = $coverDom.height(); //获取dom 高度
                    console.log($coverDom, width, height)
                    var canvas = document.createElement("canvas"); //创建一个canvas节点
                    var scale = 2; //定义任意放大倍数 支持小数
                    canvas.width = width * scale; //定义canvas 宽度 * 缩放
                    canvas.height = height * scale; //定义canvas高度 *缩放
                    //canvas.getContext("2d")
                    //修改偏移量
                    canvasDom = canvas.getContext("2d");
                    canvasDom.scale(scale, scale); //获取context,设置scale
                    canvasDom.translate('-' + $coverDom.offset().left, '-' + $coverDom.offset().top);

                    console.log($coverDom.offset().left)
                    var opts = {
                        scale: scale, // 添加的scale 参数
                        canvas: canvas, //自定义 canvas
                        // logging: true, //日志开关，便于查看html2canvas的内部执行流程
                        width: width, //dom 原始宽度
                        height: height,
                        useCORS: true // 【重要】开启跨域配置
                    };

                    return html2canvas($coverDom[0], opts).then(function (canvas) {
                        var context = canvas.getContext('2d');
                        // 【重要】关闭抗锯齿
                        context.mozImageSmoothingEnabled = false;
                        context.webkitImageSmoothingEnabled = false;
                        context.msImageSmoothingEnabled = false;
                        context.imageSmoothingEnabled = false;


                        // 【重要】默认转化的格式为png,也可设置为其他格式
                        var $img = $(Canvas2Image.convertToPNG(canvas, canvas.width, canvas.height))
                            .addClass('ximg')
                            .css({
                                width: '100%',
                            })
                        return $img;
                    });
                },

                //下拉选择
                initSelect: function () {
                    $('.js-select').each(function () {
                        var $this = $(this),
                            $selData = $this.find('select');

                        if ($selData.length == 0) {
                            return false;
                        }

                        var data = [];
                        $selData.find('option').each(function () {
                            data.push({ id: $(this).val(), value: $(this).html() })
                            if ($(this).prop('selected')) {
                                $this.find('.sel-val').html($(this).html());
                            }
                        });

                        new MobileSelect({
                            trigger: this,
                            title: $selData.data('title'),
                            wheels: [
                                { data: data }
                            ],
                            callback: function (indexArr, data) {
                                console.log(data)
                                /*TODO 这里处理选择后事件*/
                                $this.find('.sel-val').html(data[0].value);
                            }
                        });
                    })
                }
            };
            App.init();
        })
    </script>
</body>

</html>