<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    <title>远洋天著春秋服务平台－房屋维修</title>
    <script type="text/javascript" src="./js/lib/flexible.js"></script>
    <link rel="stylesheet" href="./css/page/fangwuweixiu.css">
</head>
<body>
<form class="weixiu" id="weixiuForm">
    <h3 class="title">报修信息</h3>
    <div class="weui-cells__title">报修内容：</div>
    <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <textarea name="desc" class="weui-textarea js-weui-textarea" placeholder="请描述位置－物品－善等，如：卫生间水龙头漏水。限100字内" rows="3"></textarea>
                <div class="weui-textarea-counter js-count"><span>0</span>/100</div>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <div class="weui-uploader">
                    <div class="weui-uploader__hd">
                        <p class="weui-uploader__title">图片上传</p>
                    </div>
                    <div class="weui-uploader__bd">
                        <ul class="weui-uploader__files" id="uploaderFiles"></ul>
                        <div class="weui-uploader__input-box">
                            <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/jpeg,image/jpg,image/png,image/bmp,image/gif" multiple="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="weui-cell weui-cell_select weui-cell_select-after">
            <div class="weui-cell__hd">
                <label class="weui-label">日期时间</label>
            </div>
            <div class="weui-cell__bd">
                <input class="weui-input js-date" type="text" name="time" placeholder="选择时间">
            </div>
        </div>
        <div class="weui-media-box weui-media-box_text">
            <h4 class="weui-media-box__title">手机号</h4>
            <p class="weui-media-box__desc">135xxxxxxxx</p>
        </div>
        <div class="weui-media-box weui-media-box_text">
            <h4 class="weui-media-box__title">房子信息</h4>
            <p class="weui-media-box__desc">某市某区某楼320号</p>
        </div>
        <div class="btn-box">
            <p>
                <input class="weui-btn weui-btn_primary" type="submit" value="立即预约">
                <a class="weui-btn weui-btn_primary" href="我的管家.html">联系管家</a>
            </p>
            <p>提交后将安排纵工程师与您联系，请关注保修单状态</p>
        </div>
    </div>
</form>
<div class="weui-gallery" id="gallery" style="display: none;">
    <span class="weui-gallery__img" id="galleryImg"></span>
    <div class="weui-gallery__opr">
        <a href="javascript:" class="weui-gallery__del">
            <i class="weui-icon-delete weui-icon_gallery-delete"></i>
        </a>
    </div>
</div>
<script src="./js/lib/jquery-2.1.4.min.js"></script>
<script src="./js/lib/jquery.validate.js"></script>
<script src="./js/lib/jquery-weui.min.js"></script>
<script src="./js/lib/weui.min.js"></script>
<script type="text/javascript" class="uploader js_show">
    $(function () {
        //文件上传
        var tmpl = '<li class="weui-uploader__file" style="background-image:url(#url#)"></li>',
            $gallery = $("#gallery"),
            $galleryImg = $("#galleryImg"),
            $uploaderInput = $("#uploaderInput"),
            $uploaderFiles = $("#uploaderFiles");

        $uploaderInput.on("change", function (e) {
            var src, url = window.URL || window.webkitURL || window.mozURL, files = e.target.files;
            for (var i = 0, len = files.length; i < len; ++i) {
                var file = files[i];

                if (url) {
                    src = url.createObjectURL(file);
                } else {
                    src = e.target.result;
                }

                $uploaderFiles.append($(tmpl.replace('#url#', src)));
            }
        });
        $uploaderFiles.on("click", "li", function () {
            $galleryImg.attr("style", this.getAttribute("style"));
            $gallery.fadeIn(100);
        });
        $gallery.on("click", function () {
            $gallery.fadeOut(100);
        });

        //输入内容
        $('.js-weui-textarea').on('keyup', function () {
            var $this = $(this),
                len = $this.val().length;
            if (len >= 100) {
                $this.val($this.val().subtring(0, 100))
                return;
            }
            $this.next('.js-count').find('span').html(len);
        });
        //提交
        var $validator = $("#weixiuForm").validate({
            submitHandler: function (form) {
                $.confirm("您确定要删除文件<<毛泽东语录>>吗?", "确认提交?", function () {
                    alert("去提交 form.submit();");
                    $('.weui-mask,.weui-dialog').fadeOut(200, function () {
                        $('.weui-mask,.weui-dialog').remove();
                    })
                    form.submit();
                }, function () {
                    $('.weui-mask,.weui-dialog').fadeOut(200, function () {
                        $('.weui-mask,.weui-dialog').remove();
                    })
                });
            },
            rules: {
                time: "required",
                desc: {
                    required: true,
                    maxlength: 100
                }
            },
            messages: {
                time: "请选择时间",
                desc: {
                    required: "请输入报修内容",
                    maxlength: "长度不能大于100"
                }
            }
        });
        //日期选择
        $('.js-date').on('click', function () {
            var _this = this;
            weui.datePicker({
                start: 1990,
                defaultValue: [new Date().getFullYear(), new Date().getMonth() + 1, new Date().getDate()],
                end: new Date().getFullYear() + 8,
                onConfirm: function (result) {
                    $('.weui-picker').on('animationend webkitAnimationEnd', function () {
                        show_expect_time_picker(_this, result);
                    });
                }
            });
        });
        var hours = [],
            minites = [],
            symbol = [{label: ':', value: 0}];

        function show_expect_time_picker(_this, date) {
            if (!hours.length) {
                for (var i = 0; i < 24; i++) {
                    var hours_item = {};
                    hours_item.label = ('' + i).length === 1 ? '0' + i : '' + i;
                    hours_item.value = i;
                    hours.push(hours_item);
                }
            }
            if (!minites.length) {
                for (var j = 0; j < 60; j++) {
                    var minites_item = {};
                    minites_item.label = ('' + j).length === 1 ? '0' + j : '' + j;
                    minites_item.value = j;
                    minites.push(minites_item);
                }
            }

            weui.picker(hours, symbol, minites, {
                defaultValue: [new Date().getHours() + 1, 0, 0],
                onConfirm: function (result) {
                    var time = result[0] + ':' + (result[1] < 10 ? '0' + result[1].toString() : result[1]);
                    var expect_date = date.join('-') + ' ' + time;
                    $(_this).val(expect_date);
                    $validator.form()
                }
            });
        }
    });
</script>
</body>
</html>